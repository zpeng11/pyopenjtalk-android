# This workflow will install Python dependencies, run tests and lint with a variety of Python versions
# For more information see: https://help.github.com/actions/language-and-framework-guides/using-python-with-github-actions

name: Python package

on:
  workflow_dispatch:  # 支持手动触发

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v3

    - name: Build and run with Docker Compose  # 关键调整：cd 到子目录
      run: |
        cd android  # 切换到 android/ 目录
        docker compose up --build  # 在子目录内运行，build: . 指向 android/

    - name: Verify build output
      run: |
        ls -la build/  # 检查 build/

    - name: Upload build artifacts
      uses: actions/upload-artifact@v4
      with:
        name: build-output
        path: build/  # 调整为子目录下的 build/
        retention-days: 7